<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Weather Map Project</title>
    <link href="js/keys.js">
    <script src='https://api.mapbox.com/mapbox-gl-js/v2.2.0/mapbox-gl.js'></script>
    <link href='https://api.mapbox.com/mapbox-gl-js/v2.2.0/mapbox-gl.css' rel='stylesheet' />
    <script src="js/mapbox-geocoder-utils.js"></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <script src="js/jquery-3.6.0.js"></script>

    <style>
        body{
            background-image: url("img/navbar-weather.gif");
            background-size: 80%;
            background-position-x: center;
            font-family: 'Montserrat', sans-serif;
        }
        p{
            font-weight: bolder;
        }
        img{
            height: 75px;
            width: 75px;
        }
        #currentLocation{
            font-size: 30px;
            color: gainsboro;
        }
        .card-header{
            font-size: large;
        }
        #searchForm{
            background-color: rgba(225,225,225, .2);
        }
        .card-text{
            border-bottom: 1px solid gray;
            padding-bottom: 8px;
        }
    </style>

</head>
<body>

<nav id="navbar" class="navbar navbar-expand-lg navbar-dark bg-primary d-flex justify-content-between">
  <a class="navbar-brand" href="#">Weather App</a>
    <p id="currentLocation" class="m-0 d-flex justify-self-center">Current City: San Antonio</p>
</nav>
<div id="searchForm" class=" row p-4 d-flex ">
        <form class="form-inline ml-5">
            <p class="d-flex align-self-center pr-3 m-0 ">Places</p>
            <input id="searchBar" class="form-control mr-sm-2" type="search" placeholder="Search" aria-label="Search">
            <button id="searchButton" class="btn bg-primary my-2 my-sm-0" type="submit">Find</button>
        </form>
</div>
<div class="d-flex justify-content-center">
    <div id='map' style='width: 95%; height: 650px; position: center'></div>
</div>

<div class="row d-flex justify-content-around m-3">

<!--    Day One Card-->
    <div class="card col-2">
        <div id="dayOneDate" class="card-header">
            Date
        </div>
        <div class="card-body">
            <img id="dayOneIcon" class="" src="img/weatherbit-icons/a01d.png">
            <h3 id="dayOneCurrentTemp" class="card-text">Current Temp</h3>
            <h5 id="dayOneTemp" class="card-text">Temperature</h5>
            <p id="dayOneDesc" class="card-text">Weather Description</p>
            <p id="dayOnePrecip" class="card-text">Change of Precipitation</p>
        </div>
    </div>

<!--    Day Two Card-->
    <div class="card col-2">
        <div id="dayTwoDate" class="card-header">
            Date
        </div>
        <div class="card-body">
            <img id="dayTwoIcon" class="" src="img/weatherbit-icons/a01d.png">
            <h3 id="dayTwoCurrentTemp" class="card-text">Current Temp</h3>
            <h5 id="dayTwoTemp" class="card-text">Temperature</h5>
            <p id="dayTwoDesc" class="card-text">Weather Description</p>
            <p id="dayTwoPrecip" class="card-text">Change of Precipitation</p>
        </div>
    </div>

<!--    Day Three Card-->
    <div class="card col-2">
        <div id="dayThreeDate" class="card-header">
            Date
        </div>
        <div class="card-body">
            <img id="dayThreeIcon" class="" src="img/weatherbit-icons/a01d.png">
            <h3 id="dayThreeCurrentTemp" class="card-text">Current Temp</h3>
            <h5 id="dayThreeTemp" class="card-text">Temperature</h5>
            <p id="dayThreeDesc" class="card-text">Weather Description</p>
            <p id="dayThreePrecip" class="card-text">Change of Precipitation</p>
        </div>
    </div>

<!--    Day Four Card-->
    <div class="card col-2">
        <div id="dayFourDate" class="card-header">
            Date
        </div>
        <div class="card-body">
            <img id="dayFourIcon" class="" src="img/weatherbit-icons/a01d.png">
            <h3 id="dayFourCurrentTemp" class="card-text">Current Temp</h3>
            <h5 id="dayFourTemp" class="card-text">Temperature</h5>
            <p id="dayFourDesc" class="card-text">Weather Description</p>
            <p id="dayFourPrecip" class="card-text">Change of Precipitation</p>
        </div>
    </div>

<!--    //Day Five Card-->
    <div class="card col-2">
        <div id="dayFiveDate" class="card-header">
            Date
        </div>
        <div class="card-body">
            <img id="dayFiveIcon" class="" src="img/weatherbit-icons/a01d.png">
            <h3 id="dayFiveCurrentTemp" class="card-text">Current Temp</h3>
            <h3 id="dayFiveTemp" class="card-text">Temperature</h3>
            <p id="dayFiveDesc" class="card-text">Weather Description</p>
            <p id="dayFivePrecip" class="card-text">Change of Precipitation</p>
        </div>
    </div>
</div>


<script>
    mapboxgl.accessToken = "pk.eyJ1IjoidHltZWkiLCJhIjoiY2tvZWdlNGp0MGE2azJ2b2M4MDk1bG93MSJ9.bZAESmR55PH-pCyme1t00Q";
    // Default Map centered at San Antonio
    var map = new mapboxgl.Map({
        container: 'map', // container ID
        style: 'mapbox://styles/mapbox/streets-v11', // style URL
        center: [-98.4936, 29.4241], // starting position [lng, lat]
        zoom: 11 // starting zoom
    });
    map.addControl(new mapboxgl.NavigationControl());
    //Default Weather Settings from San Antonio
    var coords = [-98.4936, 29.4241];
    function getWeather(coords){
        $.get("https://api.weatherbit.io/v2.0/forecast/daily?&days=5&units=I&lon=" + coords[0] + "&lat=" + coords[1] + "&key=46c03057a2e24304bf6ee0e0ff1fee55").done(function (weather) {

            $('#currentLocation').html("Current Location: " +  weather.city_name.toString())

            $('#dayOneDate').html(weather.data[0].valid_date.toString())
            $('#dayOneIcon').attr("src", ("img/weatherbit-icons/" + weather.data[0].weather.icon.toString() + ".png"))
            $('#dayOneCurrentTemp').html(weather.data[0].temp + "℉ ")
            $('#dayOneTemp').html(weather.data[0].low_temp.toString() + "℉ / " + weather.data[0].high_temp.toString() + "℉")
            $('#dayOneDesc').html("Description : " + weather.data[0].weather.description.toString())
            $('#dayOnePrecip').html("Chance of Precipitation: " + (parseFloat(weather.data[0].precip.toString())*100) + "%")

            $('#dayTwoDate').html(weather.data[1].valid_date.toString())
            $('#dayTwoIcon').attr("src", ("img/weatherbit-icons/" + weather.data[1].weather.icon.toString() + ".png"))
            $('#dayTwoCurrentTemp').html(weather.data[1].temp + "℉ ")
            $('#dayTwoTemp').html(weather.data[1].low_temp.toString() + "℉ / " + weather.data[1].high_temp.toString() + "℉")
            $('#dayTwoDesc').html("Description : " + weather.data[1].weather.description.toString())
            $('#dayTwoPrecip').html("Chance of Precipitation: " + (parseFloat(weather.data[1].precip.toString())*100) + "%")

            $('#dayThreeDate').html(weather.data[2].valid_date.toString())
            $('#dayThreeIcon').attr("src", ("img/weatherbit-icons/" + weather.data[2].weather.icon.toString() + ".png"))
            $('#dayThreeCurrentTemp').html(weather.data[2].temp + "℉ ")
            $('#dayThreeTemp').html(weather.data[2].low_temp.toString() + "℉ / " + weather.data[2].high_temp.toString() + "℉")
            $('#dayThreeDesc').html("Description : " + weather.data[2].weather.description.toString())
            $('#dayThreePrecip').html("Chance of Precipitation: " + (parseFloat(weather.data[2].precip.toString())*100) + "%")

            $('#dayFourDate').html(weather.data[3].valid_date.toString())
            $('#dayFourIcon').attr("src", ("img/weatherbit-icons/" + weather.data[3].weather.icon.toString() + ".png"))
            $('#dayFourCurrentTemp').html(weather.data[3].temp + "℉ ")
            $('#dayFourTemp').html(weather.data[3].low_temp.toString() + "℉ / " + weather.data[3].high_temp.toString() + "℉")
            $('#dayFourDesc').html("Description : " + weather.data[3].weather.description.toString())
            $('#dayFourPrecip').html("Chance of Precipitation: " + (parseFloat(weather.data[3].precip.toString())*100) + "%")

            $('#dayFiveDate').html(weather.data[4].valid_date.toString())
            $('#dayFiveIcon').attr("src", ("img/weatherbit-icons/" + weather.data[4].weather.icon.toString() + ".png"))
            $('#dayFiveCurrentTemp').html(weather.data[4].temp + "℉ ")
            $('#dayFiveTemp').html(weather.data[4].low_temp.toString() + "℉ / " + weather.data[4].high_temp.toString() + "℉")
            $('#dayFiveDesc').html("Description : " + weather.data[4].weather.description.toString())
            $('#dayFivePrecip').html("Chance of Precipitation: " + (parseFloat(weather.data[4].precip.toString())*100) + "%")
        })
    }
    getWeather(coords);

    //Default Marker at San Antonio
    var marker = new mapboxgl.Marker()
        .setLngLat([-98.4936, 29.4241])
        .setDraggable(true)
        .addTo(map);
    // Function to update weather settings upon dragging the marker
    marker.on('dragend', function(){
        var coords = marker.getLngLat().toArray()
        getWeather(coords);
        reverseGeocode({lat: coords[0], lng: coords[1]}, "pk.eyJ1IjoidHltZWkiLCJhIjoiY2tvZWdlNGp0MGE2azJ2b2M4MDk1bG93MSJ9.bZAESmR55PH-pCyme1t00Q").then(function(results) {
            console.log(results)
            // $("#currentCity").html(results.features[0].center)
           })
    })


    // Function for search bar
    $("#searchButton").click(function(e){
        e.preventDefault()
        // holds value of input
        barResults = $('#searchBar').val();

        // function to change current location
        $("#currentLocation").html("Current City: " + barResults.toString());

        // geocodes input location
        geocode(barResults, "pk.eyJ1IjoidHltZWkiLCJhIjoiY2tvZWdlNGp0MGE2azJ2b2M4MDk1bG93MSJ9.bZAESmR55PH-pCyme1t00Q").then(function(results) {
            console.log(results.features[0].center)

            // holds coordinates of input location in an array
            var coords = results.features[0].center;

            // sets the new center of the map to input location
            map.flyTo({
                center: [coords[0],coords[1]]
            })

            //sets marker at new location
            marker.setLngLat([coords[0],coords[1]]);
            $.get("https://api.weatherbit.io/v2.0/forecast/daily?&days=5&units=I&lon=" +coords[0] + "&lat=" +coords[1] + "&key=46c03057a2e24304bf6ee0e0ff1fee55").done(function (weather){
                console.log(weather)
                getWeather(coords);
            });
        })
    })
</script>
</body>
</html>